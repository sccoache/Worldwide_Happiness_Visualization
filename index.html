<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

	<link rel="stylesheet" type="text/css" href="css/index.css">
	<link rel="stylesheet" type="text/css" href="css/selector.css">

	<script src="//d3js.org/d3.v4.min.js"></script>
	<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
	<script src="https://d3js.org/topojson.v1.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<script src="js/cluster.js"></script>
	<script src="js/cloropleth.js"></script>
	<script src="js/selector.js"></script>
	<script src="js/happiness_barchart.js"></script>

</head>

<body >
	<h1>Visualizing Happiness Around The World</h1>

	<!-- year slider -->
	<div align="center">
	<div id="selector_div" align="center">
		<p>Selected Year: <span id="sliderVal"></span></p>
		<input type="range" min="2008" max="2016" value="2016" step="1" class="slider" id="year_range" onchange="update_page(this.value)">
	</div>
</div>

	<br>

	<!-- happiness map -->
	<div class="Map" align="center"> </div>

	<!-- cluster map -->
	<div class="Cluster" align="center">

		<div id="sidebar">
			<!-- happiness slider -->
			<section class="range-slider">
				<span id="happiness0"></span>
				<input class="slider" id="happiness1" value="2.5" min="2.5" max="10" step="0.25" type="range" onchange="filter()">
				<input class="slider" id="happiness2" value="10" min="2.5" max="10" step="0.25" type="range" onchange="filter()">
			</section>
			<p class = "sidebar_p"> happiness </p>

			<!-- gdp slider 100,000-10,000,000,000,000,000 -->
			<section class="range-slider">
				<span id="gdp0"></span>
				<input class="slider" id="gdp1" value="7" min="7" max="16" step="1" type="range" onchange="filter()">
				<input class="slider" id="gdp2" value="16" min="7" max="16" step="1" type="range" onchange="filter()">
			</section>
			<p class = "sidebar_p"> gdp </p>
		</div>
		<svg id="clusterSVG"></svg>

	</div>

	<div class="bar_holder">
		<div class="happyness_bar" align="center"> </div>
		<div class="population_bar" align="center"> </div>
		<div class="gdp_bar" align="center"> </div>
		<div class="inflation_bar" align="center"> </div>
		<div class="unemployment_bar" align="center"> </div>
		<div class="alcohol_bar" align="center"> </div>
	</div>

</body>
<script>
	var slider = document.getElementById("year_range");
	var output = document.getElementById("sliderVal");
	output.innerHTML = slider.value;

	slider.oninput = function() {
  	output.innerHTML = this.value;
	}
</script>
<script>
	var year = selector();
	cloropleth(year);
	cluster(year, get_filters());
	happinessBar(year);
	populationBar(year);
	gdpBar(year);
	inflationBar(year);
	unemploymentBar(year);
	alcoholBar(year);

	// get the current filter values
	function get_filters(){
		var ids = ["happiness", "gdp"];
		var filters = {};

		for(var i=0; i<ids.length; i++){
			var one, two;
			if(ids[i] == "gdp"){
				var power1 = document.getElementById(ids[i]+"1").value;
				var power2 = document.getElementById(ids[i]+"2").value;
				one = Math.pow(10, power1);
				two = Math.pow(10, power2);
				
				document.getElementById(ids[i]+"0").innerHTML = "1x10<sup>" + power1 + "</sup>-1x10<sup>" + power2 + "</sup>";
			} else {
				one = document.getElementById(ids[i]+"1").value;
				two = document.getElementById(ids[i]+"2").value;
				
				document.getElementById(ids[i]+"0").innerHTML = one + "-" + two;
			}

			// figure out which oen is larger
			if (one*1.0 < two*1.0){
				filters[ids[i]] = {"smaller":one, "larger":two};
			} else if(one === two){
				filters[ids[i]] = {"smaller":one, "larger":one};
			} else {
				filters[ids[i]] = {"smaller":two, "larger":one};
			}
		}
		return filters;
	}

	function update_page(year){
		year = selector();
		cloropleth(year);
		cluster(year, get_filters());
		happinessBar(year);
		populationBar(year);
		gdpBar(year);
		inflationBar(year);
		unemploymentBar(year);
		alcoholBar(year);
	}

	function filter() {
		cluster(year, get_filters());
	}
</script>
</html>
