<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

	<link rel="stylesheet" type="text/css" href="css/index.css">
	<link rel="stylesheet" type="text/css" href="css/selector.css">

	<script src="//d3js.org/d3.v4.min.js"></script>
	<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
	<script src="https://d3js.org/topojson.v1.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<script src="js/cluster.js"></script>
	<script src="js/cloropleth.js"></script>
	<script src="js/selector.js"></script>


</head>

<body>
	<h1>Average Reported Happiness</h1>

	<!-- year slider -->
	<div id="selector_div">	
		<input type="range" min="2008" max="2016" value="2016" step="1" class="slider" id="year_range" onchange="update_page(this.value)">
	</div>

	<br>

	<!-- happiness map -->
	<div class="Map"> </div>

	<!-- cluster map -->
	<div class="Cluster">
	
		<div id="sidebar">
			<!-- happiness slider -->
			<section class="range-slider">
				<span class="rangeValues"></span>
				<input class="slider" id="happiness1" value="0" min="0" max="10" step="0.25" type="range" onchange="filter('happiness',this.value)">
				<input class="slider" id="happiness2" value="10" min="0" max="10" step="0.25" type="range" onchange="filter('happiness',this.value)">
			</section>
			<p class = "sidebar_p"> happiness </p>

			<!-- gdp slider -->
			<section class="range-slider">
				<span class="rangeValues"></span>
				<input class="slider" value="5" min="0" max="15" step="0.5" type="range">
				<input class="slider" value="10" min="0" max="15" step="0.5" type="range">
			</section>
			<p class = "sidebar_p"> gdp </p>
		</div>


	</div>
</body>
<script>

	//first page load
	var year = selector();
	cloropleth(year);
	cluster(year, get_filters());

	// get the current filter values
	function get_filters(){
		var ids = ["happiness"];
		var filters = {};

		for(var i=0; i<ids.length; i++){
			var range;
			var one = document.getElementById(ids[i]+"1").value;
			var two = document.getElementById(ids[i]+"2").value;

			// figure out which oen is larger
			if (one<two){
				filters[ids[i]] = {"smaller":one, "larger":two};
			} else if(one === two){
				filters[ids[i]] = {"smaller":one, "larger":one};
			} else {
				filters[ids[i]] = {"smaller":two, "larger":one};
			}
		}
		return filters;
	}

	function update_page(year){
		year = selector();
		cloropleth(year);
		cluster(year, get_filters());
	}

	function filter(id, value) {
		cluster(year, "");
	}
</script>
</html>
